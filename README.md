## گام اول - مستند تغییرات

### افزودن قابلیت ارسال پیامک
در این قابلیت، سرویس رزرو می‌تواند بنا به درخواست مشتری پیامک تایید رزرو ارسال کند و اجرای سفارش با ارسال پیامک گزارش می‌شود.

| کلاس تغییر یافته   | توضیح کوتاه درباره تغییر                                                  |
|--------------------|---------------------------------------------------------------------------|
| MessageSender      | افزودن متد sendSms برای تعریف ارسال پیامک                                 |
| EmailSender        | پیاده‌سازی پیش‌فرض متد sendSms برای جلوگیری از استفادهٔ اشتباه            |
| SmsSender          | افزودن کلاس جدید برای ارسال واقعی پیامک و تولید خروجی مناسب               |
| ReservationService | استفاده از نوع اعلان مشتری و فراخوانی SmsSender هنگام انتخاب Notifier.SMS |

Changes: 4

### افزودن روش پرداخت حضوری (On-Site)
در این بخش امکان ثبت پرداخت حضوری برای رزرو فراهم شد تا کاربرانی که در محل پرداخت می‌کنند نیز پشتیبانی شوند.

| کلاس تغییر یافته   | توضیح کوتاه درباره تغییر                                     |
|--------------------|--------------------------------------------------------------|
| PaymentProcessor   | اضافه شدن متد payOnSite برای پرداخت حضوری                    |
| ReservationService | افزودن شاخه‌ی ONSITE به سوییچ نوع پرداخت و فراخوانی متد جدید |

Changes: 2

## گام دوم - تحلیل اصول شی‌گرایی (نسخه‌ی اولیهٔ سیستم)

| اصل | وضعیت        | کلاس               | علت برقراری / نقض                                                                                                       |
|-----|--------------|--------------------|-------------------------------------------------------------------------------------------------------------------------|
| SRP | مورد برقراری | PaymentProcessor   | تنها مسئول پرداخت است و به بخش‌های دیگر (رزرو یا اعلان) ورود نمی‌کند.                                                   |
| SRP | مورد نقض     | ReservationService | هم‌زمان تخفیف شهری، محاسبهٔ صورت‌حساب، انتخاب روش پرداخت و ارسال اعلان را انجام می‌دهد.                                 |
| OCP | مورد برقراری | Room / LuxuryRoom  | افزودن یک نوع اتاق جدید با ارث‌بری انجام می‌شود و نیازی به تغییر کلاس‌های موجود نیست.                                   |
| OCP | مورد نقض     | ReservationService | برای هر روش پرداخت یا اعلان جدید باید در ساختار switch تغییر ایجاد شود.                                                 |
| LSP | مورد برقراری | LuxuryRoom         | می‌تواند هر جا که Room انتظار می‌رود استفاده شود بدون آنکه رفتار رزرو مختل شود.                                         |
| LSP | مورد نقض ۱   | SmsSender          | پیاده‌سازی sendEmail فقط پیام خطا چاپ می‌کند و در جایگاه MessageSender قابل جایگزینی واقعی نیست.                        |
| LSP | مورد نقض ۲   | EmailSender        | به‌طور مشابه متد sendSms صرفاً پیام خطا چاپ می‌کند و جایگزینی آن برای ارسال پیامک امکان‌پذیر نیست.                      |
| ISP | مورد نقض     | MessageSender      | همهٔ پیاده‌سازی‌ها را مجبور می‌کند هم ایمیل و هم SMS را پوشش دهند حتی اگر در عمل یکی از آن‌ها بی‌معنی باشد.             |
| DIP | مورد برقراری | Reservation        | به‌جای تکیه بر LuxuryRoom، تنها به انتزاع Room متکی است.                                                                |
| DIP | مورد نقض     | ReservationService | مستقیماً نمونهٔ PaymentProcessor و EmailSender را می‌سازد و به انتزاع وابسته نیست.                                      |
| PLK | مورد برقراری | PaymentProcessor   | فقط داده‌های داخلی خود را مدیریت می‌کند و به اشیای دوردست دسترسی ندارد.                                                 |
| PLK | مورد نقض     | ReservationService | با دسترسی زنجیره‌ای به res.customer.email و res.room.price قانون دمتز را نقض می‌کند.                                    |
| CRP | مورد برقراری | بسته‌ی models      | کلاس‌های دامنه‌ای (اتاق و مشتری) با هم استفاده می‌شوند و وابستگی غیرضروری تحمیل نمی‌کنند.                               |
| CRP | مورد نقض     | بسته‌ی services    | استفاده از ReservationService عملاً ما را به PaymentProcessor و EmailSender هم وابسته می‌کند حتی اگر فقط یکی لازم باشد. |

## گام سوم - اصلاح موارد نقض

- تفکیک مسئولیت‌ها: منطق محاسبهٔ قیمت و تخفیف شهری به کلاس CityBasedPricingService منتقل شد تا ReservationService صرفاً نقش هماهنگ‌کننده داشته باشد (رفع نقض SRP و PLK).
- پیروی از OCP/DIP در پرداخت: یک انتزاع به نام PaymentHandler و نگاشت در PaymentProcessor ایجاد شد تا بدون دست‌زدن به سرویس رزرو بتوان روش پرداخت جدید اضافه کرد.
- رعایت ISP در اعلان‌ها: رابط MessageSender اکنون فقط یک متد send دارد و دو پیاده‌سازی EmailSender و SmsSender تنها مسئول کانال خودشان هستند.
- مسیریابی اعلان‌ها: کلاس جدید NotificationDispatcher تزریق می‌شود و ReservationService دیگر نمونهٔ concrete ایجاد نمی‌کند؛ در نتیجه وابستگی به انتزاع و OCP/CRP برقرار شد.
- ترکیب در نقطهٔ ورود: در Main تمام وابستگی‌ها (پرداخت، اعلان، قیمت‌گذاری) ساخته و به سرویس تزریق می‌شوند تا امکان تست و توسعهٔ جداگانه فراهم شود.
